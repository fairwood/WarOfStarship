require=function r(i,l,c){function s(e,t){if(!l[e]){if(!i[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(d)return d(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=l[e]={exports:{}};i[e][0].call(a.exports,function(t){return s(i[e][1][t]||t)},a,a.exports,r,i,l,c)}return l[e].exports}for(var d="function"==typeof require&&require,t=0;t<c.length;t++)s(c[t]);return s}({ArkInWorld:[function(t,e,o){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../DataMgr"),a=t("../WorldUI"),r=t("../UI/FlagMgr"),i=cc._decorator,l=i.ccclass,c=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprArk=null,t.sprFlag=null,t.lblName=null,t.grpInfo=null,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.setAndRefresh=function(t,e){this.data=t,this.lblName.string=t.nickname,this.refreshZoom(e),r.FlagMgr.setFlag(this.sprFlag,t.country),this.node.active=!0},t.prototype.refreshZoom=function(t){var e=n.DataMgr.getUserCurrentLocation(this.data);this.node.position=e.mul(t),this.sprArk.node.scale=.02*t},t.prototype.update=function(t){this.data&&this.refreshZoom(a.default.Instance.zoomScale)},t.prototype.onClick=function(){a.default.Instance.selectObject(this.node)},__decorate([c(cc.Sprite)],t.prototype,"sprArk",void 0),__decorate([c(cc.Sprite)],t.prototype,"sprFlag",void 0),__decorate([c(cc.Label)],t.prototype,"lblName",void 0),__decorate([c(cc.Node)],t.prototype,"grpInfo",void 0),t=__decorate([l],t)}(cc.Component);o.default=s,cc._RF.pop()},{"../DataMgr":"DataMgr","../UI/FlagMgr":"FlagMgr","../WorldUI":"WorldUI"}],ArkUI:[function(t,e,o){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./BaseUI"),r=t("./WorldUI"),g=t("./DataMgr"),i=t("./BuildPanel"),s=t("./City/Building"),l=t("./TechPanel"),c=t("./DialogPanel"),d=t("./UI/BuildingInfoPanel"),u=t("./BlockchainMgr"),p=t("./UI/ToastPanel"),h=t("./UI/ProductionPanel"),y=t("./City/ProducerBuilding"),f=t("./UI/TransferPanel"),v=cc._decorator,m=v.ccclass,_=v.property,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arkMap=null,t.ark=null,t.cargoLabelContainer=null,t.cargoLabelTemplate=null,t.cargoLabels={},t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=1,t._lastRefreshTicks=-1,t.floorTemplate=null,t.floorContainer=null,t.collectorTemplate=null,t.producerTemplate=null,t.warehouseTemplate=null,t.buildingContainer=null,t.blueprint=null,t.blueprintIndicator=null,t.canBuildColor=new cc.Color(0,190,0),t.cannotBuildColor=new cc.Color(190,0,0),t.currentHoldingBlueprint=null,t.grpBuild=null,t.btnConfirmBuild=null,t.selectedBuilding=null,t.grpBuildingInfo=null,t.nodProduceButton=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1;var e=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.deselectBuilding,this),this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.floorTemplate.active=!1,this.producerTemplate.active=!1,this.collectorTemplate.active=!1,this.warehouseTemplate.active=!1},t.prototype.start=function(){var n=this;g.DataMgr.CargoConfig.forEach(function(t){var e=cc.instantiate(n.cargoLabelTemplate);e.parent=n.cargoLabelContainer;var o=e.getComponent(cc.Label);o.string=t.Name,n.cargoLabels[t.id]=o}),this.cargoLabelTemplate.active=!1},t.prototype.onEnable=function(){this.refreshAll();g.DataMgr.myData},t.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},t.prototype.update=function(t){g.DataMgr.myData.ticks>this._lastRefreshTicks&&(this._lastRefreshTicks=g.DataMgr.myData.ticks,this.refreshAll());for(var e=g.DataMgr.getUserCurrentCargoData(g.DataMgr.myData),o=0;o<g.DataMgr.CargoConfig.length;o++){var n=g.DataMgr.CargoConfig[o],a=n.id,r=void 0,i=g.DataMgr.getUserWarehouseCap(a).toFixed();if(g.DataMgr.getBuildingInfo(a+"coll")){var l=g.DataMgr.getUserCollectorRate(g.DataMgr.myData,a+"coll");r=n.Name+"   "+Math.floor(e[n.id]).toFixed()+"/"+i+"("+(0<l?"+":"")+l.toFixed()+"/h)"}else r=n.Name+"   "+Math.floor(e[n.id]).toFixed()+"/"+i;this.cargoLabels[n.id].string=r}var c=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<c?((c-=5*t)<.5&&(c=.5),this.sldZoom.progress=c):c<.5&&(.5<(c+=5*t)&&(c=.5),this.sldZoom.progress=c)),.5!=c){var s=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(c-.5)*5*t),this.clampZoom();var d=this.zoomScale/s;this.arkMap.position=this.arkMap.position.mul(d),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i,100*this.currentBlueprintIJ.j);var u=!0;if(this.grpBuild.active=!0,"expand"==this.currentHoldingBlueprint){this.blueprint.setContentSize(300,300),this.blueprintIndicator.node.setContentSize(300,300);for(var p=-1;p<=1;p++){for(var h=-1;h<=1;h++){var f=(o=this.currentBlueprintIJ.i+p)+","+(this.currentBlueprintIJ.j+h);if(g.DataMgr.myData.expandMap[f]){u=!1;break}0<=o&&(u=!1)}if(!u)break}}else{this.blueprint.setContentSize(100,100),this.blueprintIndicator.node.setContentSize(100,100);f=this.currentBlueprintIJ.i+","+this.currentBlueprintIJ.j;g.DataMgr.myData.buildingMap[f]?u=!1:g.DataMgr.myData.expandMap[f]||(u=!1)}this.btnConfirmBuild.interactable=u,this.blueprintIndicator.node.color=u?this.canBuildColor:this.cannotBuildColor}else this.blueprint.active=!1,this.grpBuild.active=!1;this.selectedBuilding?(this.grpBuildingInfo.active=!0,this.nodProduceButton.active=null!=this.selectedBuilding.getComponent(y.default)):this.grpBuildingInfo.active=!1},t.prototype.refreshAll=function(){this.refreshBuildingData(),this.refreshZoom()},t.prototype.refreshBuildingData=function(){var o=g.DataMgr.myData.expandMap;for(var t in o)o[t].tmpDirty=!0;for(var t in this.floorContainer.children.forEach(function(t){var e=t.name;o[e]?delete o[e].tmpDirty:t.destroy()}),o)if(o[t].tmpDirty){var e=cc.instantiate(this.floorTemplate);e.parent=this.floorContainer,e.name=t;var n=JSON.parse("["+t+"]");e.position=new cc.Vec2(100*n[0],100*n[1]),e.active=!0,console.log("createfloor",t,n),delete o[t].tmpDirty}var a=g.DataMgr.myData.buildingMap;for(var t in a)a[t].tmpDirty=!0;for(var t in this.buildingContainer.children.forEach(function(t){var e=t.getComponent(s.default),o=t.name,n=a[o];n&&e.info.id==n.id?(e.setInfo(e.info,n),delete n.tmpDirty):t.destroy()}),a)if(a[t].tmpDirty){var r=a[t],i=g.DataMgr.getBuildingInfo(r.id),l=i.Prefab,c=cc.instantiate(this[l+"Template"]);c.parent=this.buildingContainer,c.name=t,c.getComponent(s.default).setInfo(i,r);n=JSON.parse("["+t+"]");c.position=new cc.Vec2(100*n[0],100*n[1]),c.active=!0,console.log("createbd",t,r),delete a[t].tmpDirty}},t.prototype.onGotoWorldClick=function(){this.deselectBuilding(),n.default.EnterUI(r.default)},t.prototype.onBuildBtnClick=function(){this.deselectBuilding(),i.default.Show(),l.default.Hide()},t.prototype.onCommanderClick=function(){},t.prototype.onCenterBtnClick=function(){this.arkMap.position=new cc.Vec2(200,0)},t.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){3<this.zoomScale&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},t.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=g.IJ.ZERO},t.prototype.dragBlueprint=function(t){var e=t.getLocation(),o=this.arkMap.convertToNodeSpaceAR(e);"expand"==this.currentHoldingBlueprint?(this.currentBlueprintIJ.i=3*Math.round((o.x/100+2)/3)-2,this.currentBlueprintIJ.j=3*Math.round(o.y/100/3)):(this.currentBlueprintIJ.i=Math.round(o.x/100),this.currentBlueprintIJ.j=Math.round(o.y/100))},t.prototype.onBtnConfirmBuildClick=function(){var e=this;if("expand"==this.currentHoldingBlueprint){for(var t=[],o=-1;o<=1;o++)for(var n=-1;n<=1;n++){var a=this.currentBlueprintIJ.i+o,r=this.currentBlueprintIJ.j+n;t.push([a,r])}u.default.Instance.callFunction("expand",[t],g.DataMgr.getExpandCost(g.DataMgr.myData.expandCnt,9)+1e-5,function(t){"Error"!=t.toString().substr(0,5)?(c.default.PopupWith2Buttons("正在递交扩建计划","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),e.currentHoldingBlueprint=null):p.default.Toast("交易失败:"+t)})}else u.default.Instance.callFunction("build",[this.currentBlueprintIJ.i,this.currentBlueprintIJ.j,this.currentHoldingBlueprint.id],0,function(t){"Error"!=t.toString().substr(0,5)?(c.default.PopupWith2Buttons("正在递交建造计划","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),e.currentHoldingBlueprint=null):p.default.Toast("交易失败:"+t)})},t.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},t.prototype.selectBuilding=function(t){console.log("选中建筑",t.name),this.selectedBuilding=t},t.prototype.deselectBuilding=function(){this.selectedBuilding=null},t.prototype.onDemolishBtnClick=function(){var e=this,o=a.Instance;this.selectedBuilding&&c.default.PopupWith2Buttons("确定拆除建筑吗",o.selectedBuilding.info.Name+"\n可回收部分建筑材料","取消",null,"拆除",function(){var t=JSON.parse("["+e.selectedBuilding.node.name+"]");u.default.Instance.callFunction("demolish",t,0,function(t){"Error"!=t.toString().substr(0,5)?c.default.PopupWith2Buttons("正在递交拆除计划","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):p.default.Toast("交易失败:"+t)}),o.deselectBuilding()})},t.prototype.onBuildingInfoBtnClick=function(){this.selectedBuilding&&(d.default.Show(this.selectedBuilding.info),this.deselectBuilding())},t.prototype.onUpgradeBtnClick=function(){var e=this,o=a.Instance;if(this.selectedBuilding){var n=g.DataMgr.getBuildingInfoItemWithLv(this.selectedBuilding.data.id,"IronCost",this.selectedBuilding.data.lv+1);c.default.PopupWith2Buttons("升级"+o.selectedBuilding.info.Name+"到Lv"+(this.selectedBuilding.data.lv+2),"需要"+n+"铁","取消",null,"升级",function(){if(g.DataMgr.getUserCurrentCargoData(g.DataMgr.myData).iron<n)p.default.Toast("铁不足");else{var t=JSON.parse("["+e.selectedBuilding.node.name+"]");u.default.Instance.callFunction("upgradeBuilding",t,0,function(t){"Error"!=t.toString().substr(0,5)?c.default.PopupWith2Buttons("正在递交升级计划","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):p.default.Toast("交易失败:"+t)}),o.deselectBuilding()}})}},t.prototype.onProduceBtnClick=function(){var t=g.DataMgr.myData.buildingMap[this.selectedBuilding.node.name];Number(new Date)<t.recoverTime?p.default.Toast("生产设施尚未冷却"):(h.default.Instance.node.active=!0,h.default.Instance.setAndRefresh(this.selectedBuilding,g.DataMgr.myData.buildingMap[this.selectedBuilding.node.name]))},t.prototype.onTransferBtnClick=function(){f.default.Instance.node.active=!0},__decorate([_(cc.Node)],t.prototype,"arkMap",void 0),__decorate([_(cc.Node)],t.prototype,"ark",void 0),__decorate([_(cc.Node)],t.prototype,"cargoLabelContainer",void 0),__decorate([_(cc.Node)],t.prototype,"cargoLabelTemplate",void 0),__decorate([_(cc.Node)],t.prototype,"panPad",void 0),__decorate([_(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([_(cc.Node)],t.prototype,"floorTemplate",void 0),__decorate([_(cc.Node)],t.prototype,"floorContainer",void 0),__decorate([_(cc.Node)],t.prototype,"collectorTemplate",void 0),__decorate([_(cc.Node)],t.prototype,"producerTemplate",void 0),__decorate([_(cc.Node)],t.prototype,"warehouseTemplate",void 0),__decorate([_(cc.Node)],t.prototype,"buildingContainer",void 0),__decorate([_(cc.Node)],t.prototype,"blueprint",void 0),__decorate([_(cc.Sprite)],t.prototype,"blueprintIndicator",void 0),__decorate([_(cc.Node)],t.prototype,"grpBuild",void 0),__decorate([_(cc.Button)],t.prototype,"btnConfirmBuild",void 0),__decorate([_(cc.Node)],t.prototype,"grpBuildingInfo",void 0),__decorate([_(cc.Node)],t.prototype,"nodProduceButton",void 0),t=a=__decorate([m],t);var a}(a.default);o.default=b,cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./BuildPanel":"BuildPanel","./City/Building":"Building","./City/ProducerBuilding":"ProducerBuilding","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./TechPanel":"TechPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel","./UI/ProductionPanel":"ProductionPanel","./UI/ToastPanel":"ToastPanel","./UI/TransferPanel":"TransferPanel","./WorldUI":"WorldUI"}],AsyncLoadSprite:[function(t,e,o){"use strict";cc._RF.push(e,"39cbcBA8NhMbplhvYeYYTtc","AsyncLoadSprite"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.delay=0,t.path="",t}return __extends(t,e),t.prototype.start=function(){setTimeout(this.loadSprite.bind(this),1e3*this.delay)},t.prototype.loadSprite=function(){try{var n=this;cc.loader.loadRes(n.path,cc.SpriteFrame,function(t,e){if(!t){var o=n.node.getComponent(cc.Sprite);o&&(o.spriteFrame=e)}})}catch(t){console.error(t)}},__decorate([r(cc.Float)],t.prototype,"delay",void 0),__decorate([r(cc.String)],t.prototype,"path",void 0),t=__decorate([a],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],AttackIslandPanel:[function(t,e,o){"use strict";cc._RF.push(e,"820acbSeDlEZbUkJ5dGpgYt","AttackIslandPanel"),Object.defineProperty(o,"__esModule",{value:!0});var l=t("../DataMgr"),c=t("../BlockchainMgr"),s=t("../DialogPanel"),d=t("./ToastPanel"),n=cc._decorator,a=n.ccclass,r=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblOccupant=null,t.lblDefTank=null,t.lblDefChopper=null,t.lblDefShip=null,t.lblIronRate=null,t.lblEnergyRate=null,t.lblAtkTankMax=null,t.lblAtkChopperMax=null,t.lblAtkShipMax=null,t.edtAtkTank=null,t.edtAtkChopper=null,t.edtAtkShip=null,t.SldAtkTank=null,t.SldAtkChopper=null,t.SldAtkShip=null,t.lblDistance=null,t.lblMethane=null,t.lblConfirmButton=null,t.tankMax=0,t.chopperMax=0,t.shipMax=0,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.setAndRefresh=function(t,e){this.starInfo=e,this.star=t,console.log("AIP.setARef",e),this.lblTitle.string="恒星 #"+t.index,this.SldAtkTank.progress=0,this.SldAtkChopper.progress=0,this.SldAtkShip.progress=0,this.edtAtkTank.string="0",this.edtAtkChopper.string="0",this.edtAtkShip.string="0",this.refreshMethaneCost(),this.lblIronRate.string=(this.starInfo.ironAbundance*this.starInfo.ironAbundance*1e4).toPrecision(4)+"/h",this.lblEnergyRate.string=(this.starInfo.energyAbundance*this.starInfo.energyAbundance*1e4).toPrecision(4)+"/h"},t.prototype.onSliderChange=function(t,e){switch(e){case"Tank":this.edtAtkTank.string=(this.SldAtkTank.progress*this.tankMax).toFixed();break;case"Chopper":this.edtAtkChopper.string=(this.SldAtkChopper.progress*this.chopperMax).toFixed();break;case"Ship":this.edtAtkShip.string=(this.SldAtkShip.progress*this.shipMax).toFixed()}this.refreshMethaneCost()},t.prototype.onEditBoxChange=function(t,e){switch(e){case"Tank":var o=parseInt(this.edtAtkTank.string);o=Math.max(0,Math.min(this.tankMax,o)),this.edtAtkTank.string=o.toFixed(),this.SldAtkTank.progress=o/this.tankMax;break;case"Chopper":o=parseInt(this.edtAtkChopper.string),o=Math.max(0,Math.min(this.chopperMax,o)),this.edtAtkChopper.string=o.toFixed(),this.SldAtkChopper.progress=o/this.chopperMax;break;case"Ship":o=parseInt(this.edtAtkShip.string),o=Math.max(0,Math.min(this.shipMax,o)),this.edtAtkShip.string=o.toFixed(),this.SldAtkShip.progress=o/this.shipMax}this.refreshMethaneCost()},t.prototype.update=function(t){if(l.DataMgr.myData){var e=this.star.data,o=e&&l.DataMgr.myData.address==e.occupant,n=o?l.DataMgr.myData:e&&e.occupant?l.DataMgr.othersData[e.occupant]:null;this.lblOccupant.string=n?n.nickname:e?e.occupant:"无",this.lblConfirmButton.string=o?"追加":"进攻",this.lblDefTank.string=e?e.army.fighter:0,this.lblDefChopper.string=e?e.army.bomber:0,this.lblDefShip.string=e?e.army.laser:0,this.tankMax=Math.floor(l.DataMgr.myData.cargoData.fighter),this.lblAtkTankMax.string="/"+this.tankMax.toFixed(),this.chopperMax=Math.floor(l.DataMgr.myData.cargoData.bomber),this.lblAtkChopperMax.string="/"+this.chopperMax.toFixed(),this.shipMax=Math.floor(l.DataMgr.myData.cargoData.laser),this.lblAtkShipMax.string="/"+this.shipMax.toFixed()}},t.prototype.refreshMethaneCost=function(){if(l.DataMgr.myData){var t=l.DataMgr.getUserCurrentCargoData(l.DataMgr.myData),e=new cc.Vec2(this.starInfo.x,this.starInfo.y),o=l.DataMgr.getUserCurrentLocation(l.DataMgr.myData),n=e.sub(o).mag(),a=l.DataMgr.getEnergyCostOfAttack(0,Math.round(this.SldAtkTank.progress*this.tankMax),Math.round(this.SldAtkChopper.progress*this.chopperMax),Math.round(this.SldAtkShip.progress*this.shipMax)),r=t.energy;this.lblDistance.string=n.toPrecision(4)+"ly",this.lblMethane.string=a.toFixed()+"/"+r.toFixed()}},t.prototype.onConfirmClick=function(){if(l.DataMgr.myData){console.log("准备攻占资源岛",this.star.name);var t=l.DataMgr.getUserCurrentCargoData(l.DataMgr.myData),e=new cc.Vec2(this.starInfo.x,this.starInfo.y),o=l.DataMgr.getUserCurrentLocation(l.DataMgr.myData),n=e.sub(o).mag();if(100<n)d.default.Toast("距离100ly之内才能进攻");else if(l.DataMgr.getEnergyCostOfAttack(n,Math.round(this.SldAtkTank.progress*this.tankMax),Math.round(this.SldAtkChopper.progress*this.chopperMax),Math.round(this.SldAtkShip.progress*this.shipMax))<=t.energy){var a=Math.round(this.SldAtkTank.progress*this.tankMax),r=Math.round(this.SldAtkChopper.progress*this.chopperMax),i=Math.round(this.SldAtkShip.progress*this.shipMax);c.default.Instance.callFunction("attackStar",[this.star.index,{fighter:a,bomber:r,laser:i}],0,function(t){"Error"!=t.toString().substr(0,5)?s.default.PopupWith2Buttons("正在递交作战计划","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):d.default.Toast("交易失败:"+t)})}else d.default.Toast("反物质不足")}},t.prototype.close=function(){this.node.active=!1},__decorate([r(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([r(cc.Label)],t.prototype,"lblOccupant",void 0),__decorate([r(cc.Label)],t.prototype,"lblDefTank",void 0),__decorate([r(cc.Label)],t.prototype,"lblDefChopper",void 0),__decorate([r(cc.Label)],t.prototype,"lblDefShip",void 0),__decorate([r(cc.Label)],t.prototype,"lblIronRate",void 0),__decorate([r(cc.Label)],t.prototype,"lblEnergyRate",void 0),__decorate([r(cc.Label)],t.prototype,"lblAtkTankMax",void 0),__decorate([r(cc.Label)],t.prototype,"lblAtkChopperMax",void 0),__decorate([r(cc.Label)],t.prototype,"lblAtkShipMax",void 0),__decorate([r(cc.EditBox)],t.prototype,"edtAtkTank",void 0),__decorate([r(cc.EditBox)],t.prototype,"edtAtkChopper",void 0),__decorate([r(cc.EditBox)],t.prototype,"edtAtkShip",void 0),__decorate([r(cc.Slider)],t.prototype,"SldAtkTank",void 0),__decorate([r(cc.Slider)],t.prototype,"SldAtkChopper",void 0),__decorate([r(cc.Slider)],t.prototype,"SldAtkShip",void 0),__decorate([r(cc.Label)],t.prototype,"lblDistance",void 0),__decorate([r(cc.Label)],t.prototype,"lblMethane",void 0),__decorate([r(cc.Label)],t.prototype,"lblConfirmButton",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../DialogPanel":"DialogPanel","./ToastPanel":"ToastPanel"}],BaseUI:[function(t,e,o){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([a],e)}(cc.Component));o.default=r,cc._RF.pop()},{}],BlockchainMgr:[function(t,e,p){"use strict";cc._RF.push(e,"3ffefed5pBCD40DXf/kM6bs","BlockchainMgr"),Object.defineProperty(p,"__esModule",{value:!0});var a=t("./DataMgr"),o=t("./DialogPanel"),n=t("./WorldUI"),r=t("./UI/ToastPanel"),i=t("./ArkUI"),l=t("./CvsMain"),c=t("./HomeUI"),s=t("./UI/AttackIslandPanel"),d=t("./MainCtrl"),u=cc._decorator,h=u.ccclass;u.property;p.ContractAddress="n1fALBF8Z4zzHaTkiLC7XCs97DoFobTeXJV",p.EncKey=37234;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkWalletCountdown=1e9,t.fetchMyDataInterval=1e9,t.fetchAllDataCountdown=1e9,t}return __extends(t,e),(u=t).prototype.onLoad=function(){u.Instance=this},t.prototype.start=function(){this.checkWalletCountdown=1,this.fetchMyDataInterval=1,this.fetchAllDataCountdown=10},t.prototype.update=function(t){try{Neb,NebPay}catch(t){return}if(this.checkWalletCountdown-=t,this.fetchMyDataInterval-=t,this.fetchAllDataCountdown-=t,this.checkWalletCountdown<=0){try{var e=this;(s=new Neb).setRequest(new HttpRequest(u.BlockchainUrl)),s.api.getNebState().then(function(t){window.addEventListener("message",e.onGetWalletData),window.postMessage({target:"contentscript",data:{},method:"getAccount"},"*")})}catch(t){console.error(t)}this.checkWalletCountdown=u.CheckWalletInterval}if(this.fetchMyDataInterval<=0&&u.WalletAddress){(s=new Neb).setRequest(new HttpRequest(u.BlockchainUrl));var o=u.WalletAddress,n="0",a="0",r="1000000",i="2000000",l={function:"getUser",args:JSON.stringify([u.WalletAddress])},c=this;s.api.call(o,p.ContractAddress,n,a,r,i,l).then(c.onGetMyData).catch(function(t){console.log("call mydata error:"+t.message,o)}),this.fetchMyDataInterval=u.FetchMyDataInterval}if(this.fetchAllDataCountdown<=0){var s;(s=new Neb).setRequest(new HttpRequest(u.BlockchainUrl));var d=u.WalletAddress?u.WalletAddress:Account.NewAccount().getAddressString();n="0",a="0",r="1000000",i="2000000",l={function:"getMapInfo",args:"[]"},c=this;s.api.call(d,p.ContractAddress,n,a,r,i,l).then(c.onGetAllMapData).catch(function(t){console.log("call get_map_info error:"+t.message)}),this.fetchAllDataCountdown=u.FetchAllDataInterval}},t.prototype.getFunction=function(e,t,o){try{var n=new Neb;n.setRequest(new HttpRequest(u.BlockchainUrl)),console.log("区块链getFunction(",e,t);var a=u.WalletAddress?u.WalletAddress:Account.NewAccount().getAddressString(),r={function:e,args:JSON.stringify(t)};n.api.call(a,p.ContractAddress,"0","0","1000000","2000000",r).then(o).catch(function(t){console.error("Neb call "+e+" error:"+t.message)})}catch(t){console.error(t)}},t.prototype.onGetWalletData=function(t){if(t.data&&t.data.data&&t.data.data.account&&0<t.data.data.account.length){var e=t.data.data.account;if(u.WalletAddress!=e){console.log("Change wallet address:",e),u.WalletAddress=e,c.default.Instance.edtBlockchainAddress.string=u.WalletAddress?u.WalletAddress:"",this.fetchAllDataCountdown=0;try{a.DataMgr.myData&&a.DataMgr.myData.address!=e&&(n.default.Instance.node.active||i.default.Instance.node.active)&&l.default.EnterUI(c.default)}catch(t){console.error(t)}}}},t.prototype.onGetMyData=function(t){console.log("onGetMyData",t);var e=JSON.parse(t.result);e&&((a.DataMgr.myData=e).ticks=d.default.Ticks)},t.prototype.onGetAllMapData=function(t){console.log("onGetAllMapData",t);var e=JSON.parse(t.result).result_data,o=e.users,n=e.islands;a.DataMgr.othersData={},o.forEach(function(t){t.address==u.WalletAddress||(a.DataMgr.othersData[t.address]=t)}),n.forEach(function(t){var e=a.DataMgr.allIslandData[t.id];if(e)for(var o in t)e[o]=t[o];else console.error("从区块链获取到未知id的island:",t)})},t.prototype.callFunction=function(t,e,o,n){try{o=Math.ceil(1e10*o)/1e10,console.log("调用钱包(",t,e,o);var a=new NebPay,r=u.BlockchainUrl,i=p.ContractAddress;a.call(i,o,t,JSON.stringify(e),{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:r,listener:n})}catch(t){console.error(t)}},t.prototype.claimNewUser=function(){try{var t=c.default.Instance.lblNickname.string,e=c.default.Instance.country,o=new NebPay,n=u.BlockchainUrl,a=p.ContractAddress;console.log("调用钱包claim_new_user(",t,e);var r='["'+t+'","'+e+'"]';o.call(a,0,"claimNewUser",r,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:n,listener:this.claimNewUserCallback})}catch(t){console.error(t)}},t.prototype.claimNewUserCallback=function(t){console.log("claimNewUserCallback: ",t),"Error"!=t.toString().substr(0,5)?o.default.PopupWith2Buttons("星舰正在传送，请等候30秒","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):r.default.Toast("交易失败:"+t)},t.prototype.move=function(t,e,o){try{var n=new NebPay,a=u.BlockchainUrl,r=p.ContractAddress;console.log("调用钱包move",t,e);var i=JSON.stringify([t,e]);n.call(r,0,"move",i,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:a,listener:this.moveCallback(o)})}catch(t){console.error(t)}},t.prototype.moveCallback=function(e){return function(t){console.log("moveCallback: ",e,t),"Error"!=t.toString().substr(0,5)?(o.default.PopupWith2Buttons("反物质引擎开始预热，如果一切顺利，将在30秒内出发","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),n.default.Instance.editSailDestinationMode=!1,e&&e()):r.default.Toast("交易失败:"+t)}},t.prototype.expand=function(t,e,o){try{var n=new NebPay,a=u.BlockchainUrl,r=p.ContractAddress,i=Math.ceil(1e6*o)/1e6,l=JSON.stringify([t,e]);console.log("调用钱包expand("+t+","+e+", valueNas",o,"value",i),n.call(r,i,"expand",l,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:a,listener:this.expandCallback})}catch(t){console.error(t)}},t.prototype.expandCallback=function(t){console.log("expandCallback: ",t),"Error"!=t.toString().substr(0,5)?o.default.PopupWith2Buttons("扩建计划已启动，请稍候","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):r.default.Toast("交易失败:"+t)},t.prototype.attackIsland=function(t,e,o,n,a){try{var r=new NebPay,i=u.BlockchainUrl,l=p.ContractAddress;console.log("调用钱包attack_island(",t,e,o,n);var c=JSON.stringify([t,e,o,n]);r.call(l,0,"attackIsland",c,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:i,listener:this.attackIslandCallback(a)})}catch(t){console.error(t)}},t.prototype.attackIslandCallback=function(e){return function(t){console.log("attackIslandCallback: ",e,t),"Error"!=t.toString().substr(0,5)?(s.default.Instance.close(),o.default.PopupWith2Buttons("您的部队已出发","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),n.default.Instance.editSailDestinationMode=!1,e&&e()):o.default.PopupWith1Button("区块链交易失败",t,"确定",null)}},t.prototype.collectIslandMoney=function(t){try{var e=new NebPay,o=u.BlockchainUrl,n=p.ContractAddress;console.log("调用钱包collectIslandMoney(",t);var a=JSON.stringify([t]);e.call(n,0,"collectIslandMoney",a,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:o,listener:this.collectIslandMoneyCallback})}catch(t){console.error(t)}},t.prototype.collectIslandMoneyCallback=function(t){console.log("collectIslandMoneyCallback: ",t),"Error"!=t.toString().substr(0,5)?(s.default.Instance.close(),o.default.PopupWith2Buttons("正在收取资源","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null)):o.default.PopupWith1Button("区块链交易失败",t,"确定",null)},t.prototype.sponsor=function(t,e,o,n){try{var a=new NebPay,r=u.BlockchainUrl,i=p.ContractAddress,l=Math.ceil(1e6*n)/1e6;console.log("调用钱包sponsor(",t,e,o,n);var c=JSON.stringify([t,e,o]);a.call(i,l,"sponsor",c,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:r,listener:this.sponsorCallback})}catch(t){console.error(t)}},t.prototype.sponsorCallback=function(t){console.log("sponsorCallback: ",t),"Error"!=t.toString().substr(0,5)?o.default.PopupWith2Buttons("感谢您的赞助","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):r.default.Toast("交易失败:"+t)},t.encrypto=function(t,e,o){if("string"==typeof t&&"number"==typeof e&&"number"==typeof o){var n=[];o=o<=25?o:o%25;for(var a=0;a<t.length;a++){var r=t.charCodeAt(a);r=(r=1*r^e).toString(o),n.push(r)}var i=String.fromCharCode(o+97);return n.join(i)}},t.BlockchainUrl="https://mainnet.nebulas.io",t.CheckWalletInterval=10,t.FetchMyDataInterval=5,t.FetchAllDataInterval=20,t=u=__decorate([h],t);var u}(cc.Component);p.default=f,cc._RF.pop()},{"./ArkUI":"ArkUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./MainCtrl":"MainCtrl","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],BuildPanel:[function(t,e,o){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),a=t("./BuildingButton"),r=t("./ArkUI"),i=t("./Utils/CurrencyFormatter"),l=cc._decorator,c=l.ccclass,s=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t.lblExpandCost=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){var o=this;n.DataMgr.BuildingConfig.forEach(function(t){if("_upgradeRate"!=t.id){var e=cc.instantiate(o.buttonTemplate);e.parent=o.buttonContainer,e.getComponent(a.default).setAndRefresh(t),e.active=!0}}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){this.lblExpandCost.string=i.default.formatNAS(n.DataMgr.getExpandCost(n.DataMgr.myData.expandCnt,9))+"NAS"},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.onBtnExpandClick=function(){r.default.Instance.currentHoldingBlueprint="expand",r.default.Instance.currentBlueprintIJ=n.IJ.ZERO,this.close()},t.prototype.close=function(){this.node.active=!1},__decorate([s(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([s(cc.Node)],t.prototype,"buttonTemplate",void 0),__decorate([s(cc.Label)],t.prototype,"lblExpandCost",void 0),t=o=__decorate([c],t);var o}(cc.Component);o.default=d,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildingButton":"BuildingButton","./DataMgr":"DataMgr","./Utils/CurrencyFormatter":"CurrencyFormatter"}],BuildingButton:[function(t,e,o){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./BuildPanel"),a=t("./ArkUI"),r=t("./DataMgr"),i=t("./DialogPanel"),l=cc._decorator,c=l.ccclass,s=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblConsumption=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t){this.info=t,this.lblName.string=t.Name;var e=t.IronCost;this.lblConsumption.string="原料 "+e+"铁"},t.prototype.onClick=function(){this.onBuildClick()},t.prototype.onBuildClick=function(){var t=r.DataMgr.getUserCurrentCargoData(r.DataMgr.myData);!t.iron||t.iron<this.info.IronCost?i.default.PopupWith1Button("建筑材料不足","需要"+this.info.IronCost+"铁，而你只有"+t.iron+"铁。","确定",null):(n.default.Hide(),a.default.Instance.enterBuildMode(this.info))},__decorate([s(cc.Label)],t.prototype,"lblName",void 0),__decorate([s(cc.Label)],t.prototype,"lblConsumption",void 0),t=__decorate([c],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel"}],BuildingInfoPanel:[function(t,e,o){"use strict";cc._RF.push(e,"3a0f2BiXhFBZ7J7uLjk6n4I","BuildingInfoPanel"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../DataMgr"),n=cc._decorator,a=n.ccclass,r=n.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblBuildingMat=null,t.lblHuman=null,t.lblRaw=null,t.lblOut=null,t.sprPic=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.refresh=function(a){this.lblName.string=a.Name;for(var r=[],t=function(t){var e=a["BuildMat"+t];if(e&&0<e.length){var o=a["BuildMat"+t+"Count"],n=i.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(n.Name+"*"+o)}},e=0;e<4;e++)t(e);this.lblBuildingMat.string=r.join("\n"),this.lblHuman.string=a.MaxHuman,r=[];var o=function(t){var e=a["Raw"+t];if(e&&0<e.length){var o=a["Raw"+t+"Rate"],n=i.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(n.Name+"*"+o)}};for(e=0;e<4;e++)o(e);this.lblRaw.string=r.join("\n"),r=[];var n=function(t){var e=a["Out"+t];if(e&&0<e.length){var o=a["Out"+t+"Rate"],n=i.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(n.Name+"*"+o)}};for(e=0;e<4;e++)n(e);this.lblOut.string=r.join("\n")},t.Show=function(e){var t;t="string"==typeof e?i.DataMgr.BuildingConfig.find(function(t){return t.id==e}):e,o.Instance.node.active=!0,o.Instance.refresh(t)},t.prototype.close=function(){this.node.active=!1},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),__decorate([r(cc.Label)],t.prototype,"lblBuildingMat",void 0),__decorate([r(cc.Label)],t.prototype,"lblHuman",void 0),__decorate([r(cc.Label)],t.prototype,"lblRaw",void 0),__decorate([r(cc.Label)],t.prototype,"lblOut",void 0),__decorate([r(cc.Sprite)],t.prototype,"sprPic",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"../DataMgr":"DataMgr"}],Building:[function(t,e,o){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../ArkUI"),a=cc._decorator,r=a.ccclass,i=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprPic=null,t.lblName=null,t.lblLv=null,t}return __extends(t,e),t.prototype.onClick=function(){n.default.Instance.selectBuilding(this)},t.prototype.setInfo=function(t,e){if(this.info=t,this.data=e,this.lblName&&(this.lblName.string=t.Name),this.lblLv&&(this.lblLv.string="Lv. "+(e.lv+1)),this.sprPic)try{var o=this;t.Pic?cc.loader.loadRes("Building/"+t.Pic,cc.SpriteFrame,function(t,e){t||(o.sprPic.spriteFrame=e)}):this.sprPic.spriteFrame=null}catch(t){console.error(t),this.sprPic.spriteFrame=null}this.refresh()},t.prototype.refresh=function(){},__decorate([i(cc.Sprite)],t.prototype,"sprPic",void 0),__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblLv",void 0),t=__decorate([r],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../ArkUI":"ArkUI"}],CollectorBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"2ffd4wRHIRBKbqpQioNYuQn","CollectorBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var a=t("../DataMgr"),n=t("./Building"),r=t("../MainCtrl"),i=cc._decorator,l=i.ccclass,c=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblOutput=null,t.nodeGear=null,t}return __extends(t,e),t.prototype.update=function(t){r.default.Ticks%200==0&&this.refresh(),this.nodeGear.rotation+=360*t},t.prototype.refresh=function(){var t=this.info,e=(a.DataMgr.myData,Number(new Date),t.Out0),o=a.DataMgr.getBuildingInfoItemWithLv(this.info.id,"Out0Rate",this.data.lv),n=a.DataMgr.getCargoInfo(e).Name;this.lblOutput.string=" "+o.toPrecision(3)+n+"/h"},__decorate([c(cc.Label)],t.prototype,"lblOutput",void 0),__decorate([c(cc.Node)],t.prototype,"nodeGear",void 0),t=__decorate([l],t)}(n.default);o.default=s,cc._RF.pop()},{"../DataMgr":"DataMgr","../MainCtrl":"MainCtrl","./Building":"Building"}],CurrencyFormatter:[function(t,e,o){"use strict";cc._RF.push(e,"4455937OnBAOLdRb9e7YASo","CurrencyFormatter"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=(n.property,function(){function t(){}return t.formatBTC=function(t){if(Math.abs(t)<1e-7)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.max(0,5-e))},t.formatNAS=function(t){var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(3,Math.max(0,4-e)))},t.formatCNY=function(t){if(Math.abs(t)<.005)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(2,Math.max(0,4-e)))},t=__decorate([a],t)}());o.default=r,cc._RF.pop()},{}],CvsMain:[function(t,e,o){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fitter=null,t.uiContainer=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).uiContainer.children.forEach(function(t){return t.active=!0})},t.EnterUI=function(e){this.Instance.uiContainer.children.forEach(function(t){t.getComponent(e)?t.active=!0:t.active=!1})},t.prototype.update=function(){var t=cc.view.getVisibleSize();this.lastVisibleSize&&t.equals(this.lastVisibleSize)||(t.width>=t.height?(this.fitter.rotation=0,this.fitter.scale=1,this.fitter.setContentSize(1080/t.height*t.width,1080)):(this.fitter.rotation=90,this.fitter.setContentSize(1080/t.width*t.height,1080),this.fitter.scale=t.width/1080),this.lastVisibleSize=t)},__decorate([r(cc.Node)],t.prototype,"fitter",void 0),__decorate([r(cc.Node)],t.prototype,"uiContainer",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],DataMgr:[function(t,e,o){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./Utils/MathUtil"),n=function(){function i(){}return i.init=function(){if(!this.inited){this.inited=!0;for(var t=0;t<300;t++){var e=i.getStarInfo(t);this.allStars.push(e)}}},i.getUserCurrentLocation=function(t){var e=new cc.Vec2(t.locationData.lastLocationX,t.locationData.lastLocationY);if(null==t.locationData.destinationX||null==t.locationData.destinationY)return e;var o=new cc.Vec2(t.locationData.destinationX,t.locationData.destinationY),n=e.sub(o).mag()/(t.locationData.speed/60/1e3),a=(Number(new Date)-t.locationData.lastLocationTime)/n;return r.default.lerpVec2(e,o,a,!0)},i.getEnergyCostOfAttack=function(t,e,o,n){return 1*(e+o+n)},i.calcCurrentMoneyInIsland=function(t){var e=t.occupant&&0<t.occupant.length;return t.money*(e?Math.exp(-t.miningRate*(Number(new Date)-t.lastMineTime)/36e5):1)},i.getBuildingInfo=function(e){return i.BuildingConfig.find(function(t){return t.id==e})},i.getCargoInfo=function(e){return i.CargoConfig.find(function(t){return t.id==e})},i.getStarInfo=function(t){var e=this.APHash1(t.toFixed()+"startheta"),o=this.APHash1(t.toFixed()+"rhostar"),n=this.APHash1(t.toFixed()+"ironrate"),a=this.APHash1(t.toFixed()+"energyrate"),r=e*Math.PI*2,i=5e3*o,l=Math.cos(r)*i,c=Math.sin(r)*i,s=new d;return s.x=l,s.y=c,s.ironAbundance=(1-o)*n,s.energyAbundance=(1-o)*a,s},i.APHash1=function(t){for(var e=2863311530,o=0;o<t.length;o++)e^=0==(1&o)?e<<7^t.charCodeAt(o)*(e>>3):~((e<<11)+t.charCodeAt(o)^e>>5);return e/2863311530/1.5+.5},i.getExpandCost=function(t,e){for(var o=0,n=t;n<t+e;n++)o+=1e-4*Math.exp(.1*n);return o},i.getBuildingInfoItemWithLv=function(t,e,o){var n=i.getBuildingInfo(t)[e],a=i.getBuildingInfo("_upgradeRate")[e];return!isNaN(a)&&0<a&&(n*=Math.pow(a,o)),n},i.getUserWarehouseCap=function(t){var e=t+"house",o=i.myData,n=0;for(var a in o.buildingMap){var r=o.buildingMap[a];r&&r.id===e&&(n+=this.getBuildingInfoItemWithLv(e,"Capacity",r.lv))}return n},i.getUserCurrentCargoData=function(t){var e={};for(var o in t.cargoData)e[o]=t.cargoData[o];var n=((new Date).valueOf()-t.lastCalcTime)/36e5,a=i.getUserCollectorRate(t,"ironcoll")*n,r=i.getUserCollectorRate(t,"energycoll")*n;return e.iron=Math.max(t.cargoData.iron,Math.min(i.getUserWarehouseCap("iron"),t.cargoData.iron+a)),e.energy=Math.max(t.cargoData.energy,Math.min(i.getUserWarehouseCap("energy"),t.cargoData.energy+r)),e},i.getUserCollectorRate=function(t,e){if(null===t)throw new Error("User NOT FOUND.");var o=0;for(var n in t.buildingMap){var a=t.buildingMap[n];a&&a.id===e&&(o+=i.getBuildingInfoItemWithLv(e,"Out0Rate",a.lv))}return o},i.othersData={},i.allStars=[],i.allIslandData={},i.changed=!1,i.outputRates={},i.shipSpeed=100,i.energyCostPerLyExpand=.01,i.inited=!1,i}();o.DataMgr=n;var d=function(){};o.StarInfo=d;var a=function(){};o.LocationData=a;var i=function(){this.expandCnt=0,this.state=0,this.hull=1,this.expandMap={},this.buildingMap={},this.cargoData={iron:0,energy:0},this.collectingStarIndex=null,this.lastCalcTime=(new Date).valueOf()};o.UserData=i;var l=function(){};o.BuildingInfo=l;var c=function(){};o.BuildingData=c;var s=function(){};o.CargoInfo=s;var u=function(){this.amount=0};o.CargoData=u;var p=function(){};o.TechInfo=p;var h=function(){};o.TechData=h;var f=function(){};o.MineInfo=f;var g=function(){this.tankPower=0,this.chopperPower=0,this.shipPower=0,this.money=0,this.sponsorName="",this.miningRate=.02,this.balanceMap=0};o.IslandData=g;var y=function(){function e(){this.i=0,this.j=0}return e.prototype.clone=function(){var t=new e;return t.i=this.i,t.j=this.j,t},Object.defineProperty(e,"ZERO",{get:function(){return new e},enumerable:!0,configurable:!0}),e}();o.IJ=y,cc._RF.pop()},{"./Utils/MathUtil":"MathUtil"}],DialogPanel:[function(t,e,o){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblContext=null,t.btn0=null,t.lblBtn0=null,t.btn1=null,t.lblBtn1=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).hide()},t.PopupWithOKButton=function(t,e){o.PopupWith1Button(t,e,"确定",null)},t.PopupWith1Button=function(t,e,o,n){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},t.PopupWith2Buttons=function(t,e,o,n,a,r){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=r,this.Instance.lblBtn1.string=a,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},t.prototype.onBtn0Click=function(){this.func0&&this.func0(),this.hide()},t.prototype.onBtn1Click=function(){this.func1&&this.func1(),this.hide()},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},__decorate([r(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([r(cc.Label)],t.prototype,"lblContext",void 0),__decorate([r(cc.Node)],t.prototype,"btn0",void 0),__decorate([r(cc.Label)],t.prototype,"lblBtn0",void 0),__decorate([r(cc.Node)],t.prototype,"btn1",void 0),__decorate([r(cc.Label)],t.prototype,"lblBtn1",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],EditNicknamePanel:[function(t,e,o){"use strict";cc._RF.push(e,"abc4c7by+pEG49b6MBNEz6Y","EditNicknamePanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../DataMgr"),a=t("./ToastPanel"),r=t("../HomeUI"),i=t("./FlagMgr"),l=t("../BlockchainMgr"),c=t("../DialogPanel"),s=cc._decorator,d=s.ccclass,u=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edtNickname=null,t.flagContainer=null,t.flagTemplate=null,t.selectFrame=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1,this.init()},t.prototype.init=function(){var n=this;this.flagTemplate.active=!0,i.FlagMgr.flagNames.forEach(function(t){var e=cc.instantiate(n.flagTemplate);e.name=t,e.parent=n.flagContainer;var o=e.getComponent(cc.Sprite);i.FlagMgr.setFlag(o,t),e.on(cc.Node.EventType.TOUCH_END,function(){return n.onFlagClick(e)})}),this.flagTemplate.active=!1},t.prototype.onEnable=function(){var e=this;this.edtNickname.string=n.DataMgr.myData?n.DataMgr.myData.nickname:r.default.Instance.lblNickname.string,this.selectedCountry=r.default.Instance.country?r.default.Instance.country:n.DataMgr.myData?n.DataMgr.myData.country:null;var t=this.flagContainer.children.find(function(t){return t.name==e.selectedCountry});t?(this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position))):this.selectFrame.active=!1},t.prototype.onFlagClick=function(t){this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position)),this.selectedCountry=t.name},t.prototype.onConfirmClick=function(){n.DataMgr.myData&&(n.DataMgr.myData.nickname=this.edtNickname.string,n.DataMgr.myData.country=this.selectedCountry),r.default.Instance.lblNickname.string=this.edtNickname.string,r.default.Instance.country=this.selectedCountry,n.DataMgr.myData?l.default.Instance.callFunction("editUser",[r.default.Instance.lblNickname.string,r.default.Instance.country],0,function(t){"Error"!=t.toString().substr(0,5)?c.default.PopupWith2Buttons("正在修改昵称","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):a.default.Toast("交易失败:"+t)}):r.default.Instance.node.active&&r.default.Instance.onClaim(),this.close()},t.prototype.close=function(){this.node.active=!1},__decorate([u(cc.EditBox)],t.prototype,"edtNickname",void 0),__decorate([u(cc.Node)],t.prototype,"flagContainer",void 0),__decorate([u(cc.Node)],t.prototype,"flagTemplate",void 0),__decorate([u(cc.Node)],t.prototype,"selectFrame",void 0),t=o=__decorate([d],t);var o}(cc.Component);o.default=p,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../DialogPanel":"DialogPanel","../HomeUI":"HomeUI","./FlagMgr":"FlagMgr","./ToastPanel":"ToastPanel"}],FlagMgr:[function(t,e,o){"use strict";cc._RF.push(e,"25e0fkSAGlFqq0SWMH7sg7L","FlagMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=(n.property,function(){function t(){}return(n=t).setFlag=function(o,e){try{n.flagNames.find(function(t){return t==e})?cc.loader.loadRes("flags/"+e,cc.SpriteFrame,function(t,e){t||(o.spriteFrame=e)}):o.spriteFrame=null}catch(t){console.error(t),o.spriteFrame=null}},t.flagNames=["cn","us","jp","kr","eng","ru","de","at","au","be","bg","br","ch","cl","co","cr","cs","dk","es","fr","gh","hr","ir","is","it","kp","ma","mx","ng","nir","nl","pa","pe","pl","pt","py","sa","sco","se","sk","sn","tn","uy","wal"],t=n=__decorate([a],t);var n}());o.FlagMgr=r,cc._RF.pop()},{}],Foreground:[function(t,e,o){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foreground"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([a],e)}(cc.Component));o.default=r,cc._RF.pop()},{}],HomeUI:[function(t,e,o){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./BaseUI"),r=t("./MainCtrl"),i=t("./DataMgr"),l=t("./WorldUI"),c=t("./UI/ToastPanel"),s=t("./BlockchainMgr"),d=t("./UI/EditNicknamePanel"),u=t("./UI/FlagMgr"),p=cc._decorator,h=p.ccclass,f=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTotalUserCount=null,t.btnWatchGalaxy=null,t.btnClaim=null,t.lblNickname=null,t.sprFlag=null,t.lblMusicButton=null,t.edtBlockchainAddress=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){c.default.Toast("正在读取您的钱包信息，如果您在用钱包玩游戏，请稍候")},t.prototype.update=function(){i.DataMgr.myData?(this.btnClaim.getComponentInChildren(cc.Label).string="进入",i.DataMgr.myData.nickname&&(this.lblNickname.string=i.DataMgr.myData.nickname),i.DataMgr.myData.country&&(this.country=i.DataMgr.myData.country)):this.btnClaim.getComponentInChildren(cc.Label).string="领取";r.default.Ticks%50==5&&u.FlagMgr.setFlag(this.sprFlag,this.country),r.default.Ticks%100==5&&(this.lblTotalUserCount.string=(Object.keys(i.DataMgr.othersData).length+(i.DataMgr.myData?1:0)).toFixed())},t.prototype.onWatchGalaxyClick=function(){console.log("观看银河系，或赞助商入口"),n.default.EnterUI(l.default)},t.prototype.onClaim=function(){if(!this.lblNickname.string||!this.country)return d.default.Instance.node.active=!0,void c.default.Toast("请先设置国旗和昵称");i.DataMgr.myData?n.default.EnterUI(l.default):s.default.Instance.claimNewUser()},t.prototype.onBtnEditNicknameClick=function(){d.default.Instance.node.active=!0},t.prototype.onBtnSponsorClick=function(){},t.prototype.onInputAddress=function(t){console.log("手动输入地址",t.string);var e=t.string;e&&(s.default.WalletAddress=e,s.default.Instance.fetchAllDataCountdown=1)},t.prototype.onAddressClick=function(){window.open("https://explorer.nebulas.io/address/"+s.default.WalletAddress)},t.prototype.onBookClick=function(){console.log("哪有白皮书")},t.prototype.onBtnClearStorageClick=function(){cc.sys.localStorage.clear(),setTimeout(function(){return location.reload()},100),console.log("成功清除存储")},t.prototype.onBtnSwitchMusicClick=function(){var t=r.default.Instance.getComponent(cc.AudioSource);t.volume=0<t.volume?0:.25,this.lblMusicButton.string=0<t.volume?"音乐：开":"音乐：关"},t.prototype.onInstallWalletClick=function(){window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")},t.prototype.onTestCheat0Click=function(){var t=Number(new Date),e=new i.UserData;(i.DataMgr.myData=e).address="testaddress",e.nickname="测试昵称",e.country="cn",e.buildingMap={"-1,1":{id:"ironcoll",lv:0,justBuildOrUpgrade:!0},"-1,2":{id:"energycoll",lv:1,justBuildOrUpgrade:!0},"-2,2":{id:"fighterprod",lv:2,recoverTime:t+6e5,justBuildOrUpgrade:!0},"-2,3":{id:"bomberprod",lv:3,recoverTime:t-1e5,justBuildOrUpgrade:!0},"-3,3":{id:"laserprod",lv:4,recoverTime:t+6e6,justBuildOrUpgrade:!1}},e.expandCnt=1,e.expandMap={"-1,1":{order:0}},e.cargoData={iron:320,energy:120},e.locationData=new i.LocationData,e.locationData={speed:100,lastLocationX:-4050,lastLocationY:-230,lastLocationTime:t-1e5,destinationX:3920,destinationY:2390},e.collectingStarIndex=24},__decorate([f(cc.Label)],t.prototype,"lblTotalUserCount",void 0),__decorate([f(cc.Button)],t.prototype,"btnWatchGalaxy",void 0),__decorate([f(cc.Button)],t.prototype,"btnClaim",void 0),__decorate([f(cc.Label)],t.prototype,"lblNickname",void 0),__decorate([f(cc.Sprite)],t.prototype,"sprFlag",void 0),__decorate([f(cc.Label)],t.prototype,"lblMusicButton",void 0),__decorate([f(cc.EditBox)],t.prototype,"edtBlockchainAddress",void 0),t=o=__decorate([h],t);var o}(a.default);o.default=g,cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./UI/EditNicknamePanel":"EditNicknamePanel","./UI/FlagMgr":"FlagMgr","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],IntroUI:[function(t,e,o){"use strict";cc._RF.push(e,"09076VctrZEVKhEeIiQ5hEn","IntroUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../CvsMain"),a=t("../HomeUI"),r=cc._decorator,i=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onBtnStartClick=function(){n.default.EnterUI(a.default)},e=__decorate([i],e)}(cc.Component));o.default=l,cc._RF.pop()},{"../CvsMain":"CvsMain","../HomeUI":"HomeUI"}],IslandInfoFrame:[function(t,e,o){"use strict";cc._RF.push(e,"c2894Vc0LZARZptbw433jyZ","IslandInfoFrame"),Object.defineProperty(o,"__esModule",{value:!0});var a=t("../DataMgr"),r=t("../Utils/CurrencyFormatter"),n=t("../WorldUI"),i=cc._decorator,l=i.ccclass,c=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblLeftMoney=null,t.lblMiningSpeed=null,t.lblOccupant=null,t.grpTitle=null,t.grpMore=null,t}return __extends(t,e),t.prototype.refresh=function(t){if(t){this.lblName.string=t.sponsorName;var e=a.DataMgr.calcCurrentMoneyInIsland(t);this.lblLeftMoney.string=r.default.formatNAS(e/1e18)+"NAS";var o=t.miningRate*e/1e18;if(this.lblMiningSpeed.string=r.default.formatNAS(o)+"NAS/小时",t.occupant&&0<t.occupant.length){var n=t.occupant==a.DataMgr.myData.address?a.DataMgr.myData:a.DataMgr.othersData[t.occupant];this.lblOccupant.string=n?n.nickname:t.occupant}else this.lblOccupant.string="(无)"}},t.prototype.refreshAsZoomScale=function(){this.grpMore.opacity=.18<n.default.Instance.zoomScale||n.default.Instance.selectedObjectNode==this.node.parent?255:0,this.grpTitle.opacity=.08<n.default.Instance.zoomScale||n.default.Instance.selectedObjectNode==this.node.parent?255:0},__decorate([c(cc.Label)],t.prototype,"lblName",void 0),__decorate([c(cc.Label)],t.prototype,"lblLeftMoney",void 0),__decorate([c(cc.Label)],t.prototype,"lblMiningSpeed",void 0),__decorate([c(cc.Label)],t.prototype,"lblOccupant",void 0),__decorate([c(cc.Node)],t.prototype,"grpTitle",void 0),__decorate([c(cc.Node)],t.prototype,"grpMore",void 0),t=__decorate([l],t)}(cc.Component);o.default=s,cc._RF.pop()},{"../DataMgr":"DataMgr","../Utils/CurrencyFormatter":"CurrencyFormatter","../WorldUI":"WorldUI"}],Island:[function(t,e,o){"use strict";cc._RF.push(e,"d5cb37wYS9LEY2kNMygFSvm","Island"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../MainCtrl"),a=t("../WorldUI"),r=cc._decorator,i=r.ccclass,l=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.btnNode=new cc.Node,this.btnNode.parent=this.node,this.btnNode.on(cc.Node.EventType.TOUCH_END,this.onClick.bind(this))},e.prototype.setData=function(t){this.data=t},e.prototype.update=function(){n.default.Ticks%60==0&&(this.infoFrame&&this.infoFrame.refresh(this.data),this.btnNode.setContentSize(this.node.width+5,this.node.height+5)),this.node.position=this.data.location.mul(a.default.Instance.zoomScale),this.infoFrame.refreshAsZoomScale()},e.prototype.onLinkClick=function(){var t=this.data.sponsorLink;t&&0<t.length&&window.open(t)},e.prototype.onClick=function(){a.default.Instance.selectIsland(this.node)},e=__decorate([i],e)}(cc.Component));o.default=l,cc._RF.pop()},{"../MainCtrl":"MainCtrl","../WorldUI":"WorldUI"}],MainCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./DataMgr"),r=t("./UI/IntroUI"),i=cc._decorator,l=i.ccclass,c=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(o=e).prototype.onLoad=function(){o.Instance=this,n.default.Instance.uiContainer.getChildByName("WorldUI").active=!0,cc.loader.loadRes("Building",function(t,e){console.log("Building loaded",e),a.DataMgr.BuildingConfig=e}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded",e),a.DataMgr.CargoConfig=e}.bind(this)),a.DataMgr.init()},e.prototype.start=function(){var e=this;n.default.EnterUI(r.default),setTimeout(function(){var t=cc.url.raw("resources/audio/bgm.mp3");e.bgmHandler=cc.audioEngine.play(t,!0,.5)},1e3)},e.prototype.update=function(t){o.Ticks++},e.Ticks=0,e=o=__decorate([l],e);var o}(cc.Component));o.default=c,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./UI/IntroUI":"IntroUI"}],MathUtil:[function(t,e,o){"use strict";cc._RF.push(e,"3be564zKv9E0oRVEIsuB7L4","MathUtil"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.lerp=function(t,e,o,n){return n&&(o=Math.max(0,Math.min(1,o))),t*(1-o)+e*o},t.lerpVec2=function(t,e,o,n){return n&&(o=Math.max(0,Math.min(1,o))),t.mul(1-o).add(e.mul(o))},t}();o.default=n,cc._RF.pop()},{}],ProducerBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"9d500wkk9VBX7d2wFCzaLaX","ProducerBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Building"),a=t("../MainCtrl"),r=cc._decorator,i=r.ccclass,l=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblCd=null,t}return __extends(t,e),t.prototype.update=function(t){a.default.Ticks%500==0&&this.refresh();var e=Number(new Date);if(e>=this.data.recoverTime)this.lblCd.string="等待生产";else{var o=this.data.recoverTime-e;this.lblCd.string="冷却中 "+(o/36e5).toFixed()+":"+(o%36e5/6e4).toFixed()+":"+(o%6e4/1e3).toFixed()}},__decorate([l(cc.Label)],t.prototype,"lblCd",void 0),t=__decorate([i],t)}(n.default);o.default=c,cc._RF.pop()},{"../MainCtrl":"MainCtrl","./Building":"Building"}],ProductionPanel:[function(t,e,o){"use strict";cc._RF.push(e,"39259NKDahDt7ia2GC8mhF5","ProductionPanel"),Object.defineProperty(o,"__esModule",{value:!0});var c=t("../DataMgr"),s=t("../BlockchainMgr"),d=t("../DialogPanel"),n=t("./AsyncLoadSprite"),u=t("./ToastPanel"),a=cc._decorator,r=a.ccclass,i=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprPic=null,t.lblBuildingName=null,t.lblLevel=null,t.lblMax=null,t.edtAmt=null,t.SldAmt=null,t.lblIn0=null,t.lblIn1=null,t.lblCd=null,t.maxAmt=0,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.setAndRefresh=function(t,e){this.building=t,this.buildingData=e,this.SldAmt.progress=0,this.onSliderChange();var o=c.DataMgr.getBuildingInfoItemWithLv(e.id,"MaxCD",e.lv),n=c.DataMgr.getBuildingInfoItemWithLv(e.id,"CDPerUnit",e.lv);this.maxAmt=Math.floor(o/n),this.lblMax.string="/"+this.maxAmt.toFixed(),this.refreshCost()},t.prototype.onSliderChange=function(){this.edtAmt.string=Math.floor(this.SldAmt.progress*this.maxAmt).toFixed(),this.refreshCost()},t.prototype.onEditBoxChange=function(){var t=parseInt(this.edtAmt.string);t=Math.max(0,Math.min(this.maxAmt,t)),this.edtAmt.string=t.toFixed(),this.SldAmt.progress=t/this.maxAmt,this.refreshCost()},t.prototype.update=function(t){},t.prototype.refreshCost=function(){var t=c.DataMgr.getBuildingInfoItemWithLv(this.buildingData.id,"In0Amt",this.buildingData.lv),e=c.DataMgr.getBuildingInfoItemWithLv(this.buildingData.id,"In1Amt",this.buildingData.lv),o=c.DataMgr.getBuildingInfoItemWithLv(this.buildingData.id,"CDPerUnit",this.buildingData.lv),n=Math.floor(this.SldAmt.progress*this.maxAmt);this.lblIn0.string=0<t?t*n+" 铁":"",this.lblIn1.string=0<e?e*n+" 反物质":"";var a=o*n;this.lblCd.string=Math.floor(a)+"h"+Math.floor(60*(a-Math.floor(a)))+"min"},t.prototype.onConfirmClick=function(){console.log("准备生产",this.buildingData);var t=Math.floor(this.SldAmt.progress*this.maxAmt);if(t<=0)u.default.Toast("生产数量必须大于0");else{var e=c.DataMgr.getBuildingInfoItemWithLv(this.buildingData.id,"In0Amt",this.buildingData.lv),o=c.DataMgr.getBuildingInfoItemWithLv(this.buildingData.id,"In1Amt",this.buildingData.lv),n=c.DataMgr.getUserCurrentCargoData(c.DataMgr.myData);if(e*t<=n.iron)if(o*t<=n.energy){var a=c.DataMgr.myData,r=c.DataMgr.getBuildingInfo(this.buildingData.id).Out0,i=c.DataMgr.getUserWarehouseCap(r);if(console.log("user.cargoData[out0]",a.cargoData[r],t,i),a.cargoData[r]+t>i)u.default.Toast("仓库容量不够");else{var l=JSON.parse("["+this.building.node.name+"]");s.default.Instance.callFunction("produce",[l[0],l[1],t],0,function(t){"Error"!=t.toString().substr(0,5)?d.default.PopupWith2Buttons("正在递交生产计划","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):u.default.Toast("交易失败:"+t)})}}else d.default.PopupWith1Button("反物质不足","采集更多或者减少生产份数","确定",null);else d.default.PopupWith1Button("铁不足","采集更多或者减少生产份数","确定",null)}},t.prototype.close=function(){this.node.active=!1},__decorate([i(n.default)],t.prototype,"sprPic",void 0),__decorate([i(cc.Label)],t.prototype,"lblBuildingName",void 0),__decorate([i(cc.Label)],t.prototype,"lblLevel",void 0),__decorate([i(cc.Label)],t.prototype,"lblMax",void 0),__decorate([i(cc.EditBox)],t.prototype,"edtAmt",void 0),__decorate([i(cc.Slider)],t.prototype,"SldAmt",void 0),__decorate([i(cc.Label)],t.prototype,"lblIn0",void 0),__decorate([i(cc.Label)],t.prototype,"lblIn1",void 0),__decorate([i(cc.Label)],t.prototype,"lblCd",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../DialogPanel":"DialogPanel","./AsyncLoadSprite":"AsyncLoadSprite","./ToastPanel":"ToastPanel"}],Road:[function(t,e,o){"use strict";cc._RF.push(e,"57853rAZexG4pEfR+Uh0ALl","Road"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Building"),a=cc._decorator,r=a.ccclass,i=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([r],e)}(n.default));o.default=i,cc._RF.pop()},{"./Building":"Building"}],SpecialArk:[function(t,e,o){"use strict";cc._RF.push(e,"af740uwBhpJLINK3QpsTq54","SpecialArk"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../WorldUI"),a=t("../DialogPanel"),r=cc._decorator,i=r.ccclass,l=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.strName="",t.distanceThreshold=1e4,t.strTooFar="",t.strInfo="",t.grpInfo=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.location=this.node.position},t.prototype.onClick=function(){n.default.Instance.selectSpecialArk(this.node)},t.prototype.refreshZoom=function(t){this.node.position=this.location.mul(t),this.grpInfo.opacity=.08<n.default.Instance.zoomScale||n.default.Instance.selectedObjectNode==this.node.parent?255:0},t.prototype.update=function(t){this.refreshZoom(n.default.Instance.zoomScale)},t.prototype.showInfo=function(t){t>this.distanceThreshold?a.default.PopupWithOKButton(this.strName,this.strTooFar):a.default.PopupWithOKButton(this.strName,this.strInfo)},__decorate([l(String)],t.prototype,"strName",void 0),__decorate([l(cc.Float)],t.prototype,"distanceThreshold",void 0),__decorate([l(String)],t.prototype,"strTooFar",void 0),__decorate([l(String)],t.prototype,"strInfo",void 0),__decorate([l(cc.Node)],t.prototype,"grpInfo",void 0),t=__decorate([i],t)}(cc.Component);o.SpecialArk=c,cc._RF.pop()},{"../DialogPanel":"DialogPanel","../WorldUI":"WorldUI"}],SponsorIslandPanel:[function(t,e,o){"use strict";cc._RF.push(e,"6fe40yau5dLRKwAtiP/MgV8","SponsorIslandPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../BlockchainMgr"),a=t("../Utils/CurrencyFormatter"),r=t("../DataMgr"),i=cc._decorator,l=i.ccclass,c=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edtName=null,t.edtLink=null,t.edtValue=null,t.lblCurMoney=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.setData=function(t){if((this.island=t).data.sponsor==n.default.WalletAddress)this.lblCurMoney.string="0";else{var e=r.DataMgr.calcCurrentMoneyInIsland(t.data);this.lblCurMoney.string=a.default.formatNAS(1.101*e/1e18)}},t.prototype.onConfirmClick=function(){n.default.Instance.sponsor(this.island.data.id,this.edtName.string,this.edtLink.string,parseFloat(this.edtValue.string))},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.EditBox)],t.prototype,"edtName",void 0),__decorate([c(cc.EditBox)],t.prototype,"edtLink",void 0),__decorate([c(cc.EditBox)],t.prototype,"edtValue",void 0),__decorate([c(cc.Label)],t.prototype,"lblCurMoney",void 0),t=o=__decorate([l],t);var o}(cc.Component);o.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../Utils/CurrencyFormatter":"CurrencyFormatter"}],Star:[function(t,e,o){"use strict";cc._RF.push(e,"2559bSubDRPDKDuTT8FznW0","Star"),Object.defineProperty(o,"__esModule",{value:!0});var a=t("../WorldUI"),r=t("../BlockchainMgr"),i=t("../Utils/MathUtil"),n=cc._decorator,l=n.ccclass,c=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spr=null,t.btn=null,t.mouseHover=!1,t}return __extends(t,e),(n=t).prototype.onLoad=function(){var t=this;this.btn.on(cc.Node.EventType.MOUSE_ENTER,function(){t.mouseHover=!0},this),this.btn.on(cc.Node.EventType.MOUSE_LEAVE,function(){t.mouseHover=!1},this)},t.prototype.setAndRefresh=function(t,e){this.index=t,this.info=e,this.spr.color=n.getColor(e);var o=4*n.getRelSize(e);this.node.setContentSize(o,o)},t.prototype.refreshZoom=function(t){if(this.info){var e=new cc.Vec2(this.info.x,this.info.y);this.node.position=e.mul(t),this.btn.scale=Math.min(1,t)}},t.prototype.update=function(t){this.btn.opacity=a.default.Instance.selectedObjectNode==this.node||this.mouseHover?255:0,this.btn.color=a.default.Instance.selectedObjectNode==this.node?cc.Color.YELLOW:new cc.Color(80,80,255),this.info},t.prototype.onCircleClick=function(){a.default.Instance.selectObject(this.node),this.fetchBlockchainData()},t.prototype.fetchBlockchainData=function(){var e=this;r.default.Instance.getFunction("getStarData",[this.index],function(t){e.data=JSON.parse(t.result)})},t.prototype.getCanCollectCargos=function(){var t={iron:0,energy:0};if(!this.data)return t;var e=this.info.ironAbundance*this.info.ironAbundance*1e4,o=this.info.energyAbundance*this.info.energyAbundance*1e4,n=((new Date).valueOf()-this.data.lastMineTime)/36e5;return t.iron=e*n,t.energy=o*n,t},t.getColor=function(t){var e=Math.min(1,i.default.lerp(.5,1.2,t.ironAbundance,!0)),o=Math.min(1,i.default.lerp(.5,1.2,t.energyAbundance,!0)),n=(e+o)/2;return new cc.Color(255*e,255*o,255*n)},t.getRelSize=function(t){return i.default.lerp(.7,1.5,(t.ironAbundance+t.energyAbundance)/2)},__decorate([c(cc.Node)],t.prototype,"spr",void 0),__decorate([c(cc.Node)],t.prototype,"btn",void 0),t=n=__decorate([l],t);var n}(cc.Component);o.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../Utils/MathUtil":"MathUtil","../WorldUI":"WorldUI"}],TaskMgr:[function(t,e,o){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();o.default=n,cc._RF.pop()},{}],TechButton:[function(t,e,o){"use strict";cc._RF.push(e,"381b4B+yDRNAIom8tWyu99R","TechButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),a=cc._decorator,r=a.ccclass,i=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblWork=null,t.prgWork=null,t.gear=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){this.info=t,this.lblName.string=t.Name,this.data?this.lblWork.string=this.data.filledWork.toFixed()+" / "+t.Work:this.lblWork.string=t.Work.toString(),this.data=e,this.prgWork.progress=e.filledWork/t.Work},t.prototype.update=function(t){this.prgWork.progress=this.data.filledWork/this.info.Work,n.DataMgr.currentWorkingTech==this.info.id?(this.gear.active=!0,this.gear.rotation+=18*n.DataMgr.researchRatePerMin*t):this.gear.active=!1},t.prototype.onClick=function(){n.DataMgr.currentWorkingTech!=this.info.id?n.DataMgr.currentWorkingTech=this.info.id:n.DataMgr.currentWorkingTech=null},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblWork",void 0),__decorate([i(cc.ProgressBar)],t.prototype,"prgWork",void 0),__decorate([i(cc.Node)],t.prototype,"gear",void 0),t=__decorate([r],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./DataMgr":"DataMgr"}],TechPanel:[function(t,e,o){"use strict";cc._RF.push(e,"3402dUp2TBLFIsk2dVlT1d5","TechPanel"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("./DataMgr"),i=t("./TechButton"),n=cc._decorator,a=n.ccclass,l=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){var a=this;r.DataMgr.TechConfig.forEach(function(e){var t=cc.instantiate(a.buttonTemplate);t.parent=a.buttonContainer;var o=t.getComponent(i.default),n=r.DataMgr.myTechData.find(function(t){return t.id==e.id});o.setAndRefresh(e,n),t.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([l(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([l(cc.Node)],t.prototype,"buttonTemplate",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=c,cc._RF.pop()},{"./DataMgr":"DataMgr","./TechButton":"TechButton"}],ToastPanel:[function(t,e,o){"use strict";cc._RF.push(e,"159ccmVx0JBF6iFx9aAYPqK","ToastPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toastTemplate=null,t.container=null,t}return __extends(t,e),(n=t).prototype.onLoad=function(){(n.Instance=this).toastTemplate.active=!1},t.prototype.toast=function(t){var e=cc.instantiate(n.Instance.toastTemplate);e.parent=this.container,e.getComponent(cc.Label).string=t,e.active=!0;var o=cc.sequence(cc.delayTime(4.5),cc.fadeOut(.5));e.runAction(o),setTimeout(function(){e.destroy()},5e3)},t.Toast=function(t){n.Instance.toast(t)},__decorate([r(cc.Node)],t.prototype,"toastTemplate",void 0),__decorate([r(cc.Node)],t.prototype,"container",void 0),t=n=__decorate([a],t);var n}(cc.Component);o.default=i,cc._RF.pop()},{}],TransferPanel:[function(t,e,o){"use strict";cc._RF.push(e,"a148bXB1UJAYaIOXKI56guZ","TransferPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../BlockchainMgr"),a=t("../DialogPanel"),r=t("./ToastPanel"),i=cc._decorator,l=i.ccclass,c=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edtReceiver=null,t.edtValue=null,t.cargoName="iron",t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.onToggleClick=function(t,e){this.cargoName=e},t.prototype.onConfirmClick=function(){try{var t=[this.edtReceiver.string,this.cargoName,parseFloat(this.edtValue.string)];n.default.Instance.callFunction("transfer",t,0,function(t){"Error"!=t.toString().substr(0,5)?a.default.PopupWith2Buttons("正在申请转移资源","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):r.default.Toast("交易失败:"+t)})}catch(t){console.error(t)}},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.EditBox)],t.prototype,"edtReceiver",void 0),__decorate([c(cc.EditBox)],t.prototype,"edtValue",void 0),t=o=__decorate([l],t);var o}(cc.Component);o.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DialogPanel":"DialogPanel","./ToastPanel":"ToastPanel"}],WarehouseBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"4551bhwrptGmI96ad9hW5WZ","WarehouseBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../DataMgr"),a=t("./Building"),r=cc._decorator,i=r.ccclass,l=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblCapacity=null,t}return __extends(t,e),t.prototype.update=function(){this.lblCapacity.string=n.DataMgr.getBuildingInfoItemWithLv(this.data.id,"Capacity",this.data.lv)},__decorate([l(cc.Label)],t.prototype,"lblCapacity",void 0),t=__decorate([i],t)}(a.default);o.default=c,cc._RF.pop()},{"../DataMgr":"DataMgr","./Building":"Building"}],WorldUI:[function(t,e,o){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./BaseUI"),_=t("./MainCtrl"),r=t("./ArkUI"),b=t("./DataMgr"),i=t("./BlockchainMgr"),l=t("./HomeUI"),M=t("./World/Island"),c=t("./UI/AttackIslandPanel"),s=t("./DialogPanel"),C=t("./Utils/CurrencyFormatter"),d=t("./UI/IslandInfoFrame"),u=t("./UI/ToastPanel"),D=t("./World/SpecialArk"),I=t("./World/ArkInWorld"),k=t("./World/Star"),p=cc._decorator,h=p.ccclass,f=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.islandContainer=null,t.arkContainer=null,t.arkTemplate=null,t.starContainer=null,t.starTemplate=null,t.worldMap=null,t.earth=null,t.grpSelectObject=null,t.grpSelectSpeArk=null,t.selectFrame=null,t.btnObjectInfo=null,t.btnSponsorLink=null,t.lblAttackButton=null,t.btnCollectIsland=null,t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=.2,t.lastTickZoomScale=null,t.lblAsideSelectFrame=null,t.editSailDestinationMode=!1,t.grpSail=null,t.sailDestinationIndicator=null,t.lblDestinationInfo=null,t.btnCancelSail=null,t.btnConfirmSail=null,t.islandInfoFrameTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1;var e=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.onPanPadTouchEnd,this),this.initIslandInfoFrames()},t.prototype.start=function(){for(var t=0;t<b.DataMgr.allStars.length;t++){var e=b.DataMgr.allStars[t],o=cc.instantiate(this.starTemplate);o.parent=this.starContainer,o.position=new cc.Vec2(e.x,e.y);var n=o.getComponent(k.default);n.setAndRefresh(t,e),o.active=!0,o.name=t.toFixed(),n.btn.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),n.btn.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this)}this.starTemplate.active=!1},t.prototype.onEnable=function(){if(this.editSailDestinationMode=!1,this.selectedObjectNode=null,b.DataMgr.myData)try{this.refreshData(),this.refreshZoom()}catch(t){console.error(t)}},t.prototype.onBtnBackClick=function(){n.default.EnterUI(l.default)},t.prototype.refreshData=function(){for(var t=Object.keys(b.DataMgr.othersData).length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}for(var o=[],n=t;n<this.arkContainer.childrenCount;n++)o.push(this.arkContainer.children[n]);o.forEach(function(t){return t.destroy()}),this.refreshMyCity();var a=0;for(var r in b.DataMgr.othersData){var i=b.DataMgr.othersData[r];this.arkContainer.children[a+1].getComponent(I.default).setAndRefresh(i,this.zoomScale),a++}},t.prototype.refreshMyCity=function(){b.DataMgr.myData?this.arkContainer.children[0].getComponent(I.default).setAndRefresh(b.DataMgr.myData,this.zoomScale):this.arkContainer.children[0].active=!1},t.prototype.refreshZoom=function(){this.earth.scale=this.zoomScale,this.editSailDestinationMode&&this.newDestination&&(this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale))},t.prototype.update=function(t){var e=this;(b.DataMgr.changed||_.default.Ticks%100==0)&&(this.refreshData(),b.DataMgr.changed=!1);var o=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<o?((o-=5*t)<.5&&(o=.5),this.sldZoom.progress=o):o<.5&&(.5<(o+=5*t)&&(o=.5),this.sldZoom.progress=o)),.5!=o){var n=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(o-.5)*5*t),this.clampZoom();var a=this.zoomScale/n;this.worldMap.position=this.worldMap.position.mul(a),this.refreshZoom()}if(this.lastTickZoomScale!=this.zoomScale&&(this.lastTickZoomScale=this.zoomScale,this.starContainer.children.forEach(function(t){return t.getComponent(k.default).refreshZoom(e.zoomScale)})),this.selectedObjectNode){this.selectFrame.active=!0,this.selectFrame.position=this.selectedObjectNode.position;var r=this.selectedObjectNode.getComponent(I.default),i=this.selectedObjectNode.getComponent(k.default),l=this.selectedObjectNode.getComponent(D.SpecialArk),c=this.selectedObjectNode.getComponent(M.default);if(i){this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!0;var s=void 0;i.data?i.data.occupant&&i.data.occupant==b.DataMgr.myData.address?(this.lblAttackButton.string="追加\n驻军",this.btnCollectIsland.node.active=!0,this.btnCollectIsland.getComponentInChildren(cc.Label).string="收取",s="我方占领"):(this.lblAttackButton.string="攻占",this.btnCollectIsland.node.active=!1,s=i.data.occupant?"他人占领":"无人占领"):(this.lblAttackButton.string="攻占",this.btnCollectIsland.node.active=!1,s="正在获得数据"),this.lblAsideSelectFrame.string="铁"+(i.info.ironAbundance*i.info.ironAbundance*1e4).toPrecision(4)+"/h\n反物质"+(i.info.energyAbundance*i.info.energyAbundance*1e4).toPrecision(4)+"/h\n"+s}else if(r)this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!1;else if(c){if(this.btnSponsorLink.getComponentInChildren(cc.Label).string=c.data.sponsorName?c.data.sponsorName:"无赞助商",c.data.occupant&&c.data.occupant==b.DataMgr.myData.address){this.lblAttackButton.string="追加\n驻军";var d=c.data.lastMineTime,u=(Number(new Date)-d)/36e5,p=c.data.miningRate,h=c.data.money*(1-Math.exp(-p*u))/1e18;this.btnCollectIsland.node.active=!0,this.btnCollectIsland.getComponentInChildren(cc.Label).string="收取\n"+C.default.formatNAS(h)+"NAS"}else this.lblAttackButton.string="攻占",this.btnCollectIsland.node.active=!1;this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!0}else l&&(this.grpSelectObject.active=!1,this.grpSelectSpeArk.active=!0)}else this.grpSelectSpeArk.active=!1,this.selectFrame.active=!1,this.grpSelectObject.active=!1;if(this.editSailDestinationMode){if(this.grpSail.active=!0,this.sailDestinationIndicator.active=null!=this.newDestination,this.newDestination){var f=b.DataMgr.getUserCurrentLocation(b.DataMgr.myData),g=this.newDestination.sub(f).mag(),y=g/b.DataMgr.shipSpeed,v=g*(5+b.DataMgr.myData.expandCnt)*b.DataMgr.energyCostPerLyExpand,m=g.toFixed()+" ly\n"+y.toFixed()+" min\n"+v.toFixed()+" 反物质";this.lblDestinationInfo.string=m}}else this.grpSail.active=!1,this.sailDestinationIndicator.active=!1},t.prototype.onGotoArkClick=function(){b.DataMgr.myData?n.default.EnterUI(r.default):u.default.Toast("观察模式无法进入星舰界面")},t.prototype.onCenterBtnClick=function(){var t=b.DataMgr.myData,e=b.DataMgr.getUserCurrentLocation(t);e.mulSelf(this.zoomScale),this.worldMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onPanPadTouchEnd=function(t){if(this.editSailDestinationMode){var e=t.getLocation();if(new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20){var o=this.worldMap.convertTouchToNodeSpaceAR(t.touch);this.newDestination=o.mul(1/this.zoomScale),this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale)}}if(this.selectedObjectNode){e=t.getLocation();new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20&&this.cancelSelectObject()}},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){10<this.zoomScale&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},t.prototype.selectObject=function(t){if(this.editSailDestinationMode)return this.newDestination=t.position.mul(1/this.zoomScale),void(this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale));this.selectedObjectNode=t},t.prototype.selectSpecialArk=function(t){this.editSailDestinationMode||(this.selectedObjectNode=t)},t.prototype.selectIsland=function(t){this.editSailDestinationMode||(this.selectedObjectNode=t)},t.prototype.cancelSelectObject=function(){this.selectedObjectNode=null},t.prototype.onSelectObjectInfoClick=function(){var t=this.selectedObjectNode.getComponent(D.SpecialArk);if(t){var e=b.DataMgr.getUserCurrentLocation(b.DataMgr.myData).sub(t.location).mag();t.showInfo(e)}},t.prototype.onBtnInfoClick=function(){this.selectedObjectNode&&(this.selectedObjectNode.getComponent(k.default)?this.onBtnAttackStarClick():this.selectedObjectNode.getComponent(I.default)||this.selectedObjectNode.getComponent(M.default)&&this.onBtnAttackIslandClick())},t.prototype.onBtnAttackStarClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(k.default):null;t&&(c.default.Instance.node.active=!0,c.default.Instance.setAndRefresh(t,t.info))},t.prototype.onBtnAttackIslandClick=function(){(this.selectedObjectNode?this.selectedObjectNode.getComponent(M.default):null)&&(c.default.Instance.node.active=!0)},t.prototype.onBtnCollectIslandClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(M.default):null;t&&t.data.occupant==b.DataMgr.myData.address&&i.default.Instance.collectIslandMoney(t.data.id);var e=this.selectedObjectNode?this.selectedObjectNode.getComponent(k.default):null;if(e&&e.data.occupant==b.DataMgr.myData.address){var o=e.getCanCollectCargos();s.default.PopupWith2Buttons("收取资源","现在可以收集"+o.iron+" 铁，"+o.energy+" 反物质。\n收集恒星物资时，不受距离限制。\n被其他玩家抢占时，未收取的资源也会被抢走。","立即收取",function(){i.default.Instance.callFunction("collectStar",[e.index],0,function(t){"Error"!=t.toString().substr(0,5)?s.default.PopupWith2Buttons("正在收集","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):u.default.Toast("交易失败:"+t)})},"取消",null)}},t.prototype.onBtnSetDestinationClick=function(){if(this.selectedObjectNode){this.editSailDestinationMode=!0;var t=this.selectedObjectNode.position;this.newDestination=t.mul(1/this.zoomScale),this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale);var e=this.selectedObjectNode.getComponent(k.default).info;console.log(e.x,e.y,this.newDestination,this.zoomScale),this.selectedObjectNode=null}},t.prototype.onBtnSailClick=function(){this.selectedObjectNode=null,this.editSailDestinationMode=!0,this.newDestination=null},t.prototype.onCancelSailClick=function(){this.editSailDestinationMode=!1,this.newDestination=null},t.prototype.onConfirmMoveClick=function(){if(this.newDestination){var t=b.DataMgr.myData,e=b.DataMgr.getUserCurrentLocation(t),o=this.newDestination.sub(e).mag()*(t.expandCnt+5)*b.DataMgr.energyCostPerLyExpand;b.DataMgr.getUserCurrentCargoData(t).energy<o?u.default.Toast("反物质燃料不足"):(console.log("ConfirmMove",this.newDestination),i.default.Instance.move(this.newDestination.x,this.newDestination.y,null))}else u.default.Toast("请先点击地图空白位置，选择目的地，再点√")},t.prototype.initIslandInfoFrames=function(){var o=this;this.islandContainer.children.forEach(function(t){var e=cc.instantiate(o.islandInfoFrameTemplate);e.parent=t,e.position=o.islandInfoFrameTemplate.position,t.getComponent(M.default).infoFrame=e.getComponent(d.default),e.active=!0}),this.islandInfoFrameTemplate.active=!1},__decorate([f(cc.Node)],t.prototype,"islandContainer",void 0),__decorate([f(cc.Node)],t.prototype,"arkContainer",void 0),__decorate([f(cc.Node)],t.prototype,"arkTemplate",void 0),__decorate([f(cc.Node)],t.prototype,"starContainer",void 0),__decorate([f(cc.Node)],t.prototype,"starTemplate",void 0),__decorate([f(cc.Node)],t.prototype,"worldMap",void 0),__decorate([f(cc.Node)],t.prototype,"earth",void 0),__decorate([f(cc.Node)],t.prototype,"grpSelectObject",void 0),__decorate([f(cc.Node)],t.prototype,"grpSelectSpeArk",void 0),__decorate([f(cc.Node)],t.prototype,"selectFrame",void 0),__decorate([f(cc.Button)],t.prototype,"btnObjectInfo",void 0),__decorate([f(cc.Button)],t.prototype,"btnSponsorLink",void 0),__decorate([f(cc.Label)],t.prototype,"lblAttackButton",void 0),__decorate([f(cc.Button)],t.prototype,"btnCollectIsland",void 0),__decorate([f(cc.Node)],t.prototype,"panPad",void 0),__decorate([f(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([f(cc.Label)],t.prototype,"lblAsideSelectFrame",void 0),__decorate([f(cc.Node)],t.prototype,"grpSail",void 0),__decorate([f(cc.Node)],t.prototype,"sailDestinationIndicator",void 0),__decorate([f(cc.Label)],t.prototype,"lblDestinationInfo",void 0),__decorate([f(cc.Node)],t.prototype,"btnCancelSail",void 0),__decorate([f(cc.Node)],t.prototype,"btnConfirmSail",void 0),__decorate([f(cc.Node)],t.prototype,"islandInfoFrameTemplate",void 0),t=o=__decorate([h],t);var o}(a.default);o.default=g,cc._RF.pop()},{"./ArkUI":"ArkUI","./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./MainCtrl":"MainCtrl","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/IslandInfoFrame":"IslandInfoFrame","./UI/ToastPanel":"ToastPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./World/ArkInWorld":"ArkInWorld","./World/Island":"Island","./World/SpecialArk":"SpecialArk","./World/Star":"Star"}]},{},["ArkUI","BaseUI","BlockchainMgr","BuildPanel","BuildingButton","Building","CollectorBuilding","ProducerBuilding","Road","WarehouseBuilding","CvsMain","DataMgr","DialogPanel","Foreground","HomeUI","MainCtrl","TaskMgr","TechButton","TechPanel","AsyncLoadSprite","AttackIslandPanel","BuildingInfoPanel","EditNicknamePanel","FlagMgr","IntroUI","IslandInfoFrame","ProductionPanel","SponsorIslandPanel","ToastPanel","TransferPanel","CurrencyFormatter","MathUtil","WorldUI","ArkInWorld","Island","SpecialArk","Star"]);